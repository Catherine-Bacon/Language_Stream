<html>
  <head>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 15px 15px 10px 15px;
        width: 350px;
        /* Start with Netflix height, JS will adjust */
        height: 440px; 
        overflow-y: hidden;
        /* Reverting padding-top to 50px for the title row */
        padding-top: 50px; 
        position: relative;
      }

      /* --- MASTER MODE TOGGLE (FULL WIDTH SECTION) --- */
      .master-mode-switcher {
        display: flex;
        width: 100%; /* Make the button container span full width */
        margin-top: 0;
        margin-bottom: 10px;
        border-radius: 4px;
        overflow: hidden;
      }
      .master-mode-btn {
        width: 50%;
        padding: 6px 4px; /* Retain compact padding */
        background-color: #f0f0f0;
        color: #555;
        border: none;
        cursor: pointer;
        font-size: 0.8em; /* Retain small font size */
        font-weight: bold;
        transition: background-color 0.2s, color 0.2s;
        border-radius: 4px;
        flex-grow: 1; /* Ensure they divide the full width equally */
      }
      /* Remove internal margins/gaps as they conflict with full-width spanning */
      .master-mode-btn:first-child {
        margin-right: 2px;
      }
      .master-mode-btn:last-child {
        margin-left: 2px;
      }
      .master-mode-btn:hover {
        background-color: #e0e0e0;
      }
      .master-mode-btn.active {
        background-color: #4CAF50;
        color: white;
      }
      /* --- END: Master Mode Styles --- */
      
      /* --- HEADER ROW (Title and Streaming Icons) --- */
      h1 {
        color: #e50914; /* Netflix Red */
        font-size: 1.5em;
        margin-top: 0px;
        margin-bottom: 0px;
        position: absolute;
        top: 12px;
        left: 15px;
      }
      /* --- START: Mode Switcher Styles (Streaming Service Icons) --- */
      .mode-switcher {
        position: absolute;
        top: 10px;
        right: 15px;
        display: flex;
        gap: 8px;
      }
      .mode-icon {
        width: 30px;
        height: 30px;
        cursor: pointer;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid transparent;
        transition: border-color 0.2s, background-color 0.2s;
      }
      .mode-icon:hover {
        background-color: #f0f0f0;
      }
      .mode-icon.active {
        border-color: #e50914; /* Default to Netflix Red */
      }
      .mode-icon.active#youtubeModeButton {
        border-color: #FF0000;
      }
      .mode-icon.active#disneyModeButton {
        border-color: #0d8199;
      }
      .mode-icon.active#primeModeButton {
        border-color: #00A8E1;
      }
      /* --- END: Mode Switchter Styles --- */
      
      h2 {
        font-size: 1.1em;
        border-bottom: 1px solid #ccc;
        padding-bottom: 5px;
        margin-top: 10px;
        margin-bottom: 10px;
      }
      label, p {
        font-size: 0.9em;
        color: #333;
      }
      select, button, input[type="text"], textarea {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        margin-bottom: 0px;
        border-radius: 4px;
        border: 1px solid #ddd;
        box-sizing: border-box;
        font-family: Arial, sans-serif;
      }
      /* --- NEW: Textarea styling --- */
      textarea {
        resize: none;
        height: 100px;
        margin-top: 0;
      }
      #subtitleUrlInput, #disneyUrlInput {
        margin-top: 0;
      }
      #targetLanguage {
        margin-top: 0;
      }
      button {
        background-color: #e50914;
        color: white;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.2s;
        margin-top: 0;
        margin-bottom: 5px;
      }
      /* --- NEW: Prime Upload Button Style --- */
      button#primeUploadButton {
        background-color: #00A8E1;
        margin-top: 0;
      }
      button#primeUploadButton:hover {
        background-color: #00bfff;
      }
      /* --- END --- */
      
      #confirmButton {
        margin-top: 10px;
        margin-bottom: 10px; 
      }
      
      button:hover {
        background-color: #f40a16;
      }
      button#cancelButton {
        background-color: #777;
        margin-top: 15px;
        margin-bottom: 0px;
        display: block;
      }
      button#cancelButton:hover {
        background-color: #999;
      }
      button:disabled,
      button[disabled]{
        background-color: #cccccc;
        color: #666666;
        cursor: not-allowed;
      }
      button:disabled:hover,
      button[disabled]:hover {
        background-color: #cccccc;
      }

      .hidden-no-space {
          display: none !important;
          margin-top: 0 !important;
          margin-bottom: 0 !important;
          padding-top: 0 !important;
          padding-bottom: 0 !important;
          height: 0 !important;
          visibility: hidden !important;
      }

      #statusBox {
        margin-bottom: 10px;
        padding: 5px;
        border: 1px solid #eee;
        background-color: #f9f9f9;
        border-radius: 4px;
        text-align: center;
      }
      #progressBarContainer {
        width: 100%;
        background-color: #ddd;
        border-radius: 5px;
        margin-top: 10px;
        margin-bottom: 10px;
        overflow: hidden;
      }
      #progressBar {
        width: 0%;
        height: 15px;
        background-color: #4CAF50;
        text-align: center;
        line-height: 15px;
        color: white;
        transition: width 0.3s;
      }

      h3 {
        font-size: 1.1em;
        border-bottom: 1px solid #ccc;
        padding-bottom: 5px;
        margin-top: 10px;
        margin-bottom: 10px;
      }

      .preference-row {
          display: flex;
          align-items: center;
          gap: 10px;
          margin-bottom: 10px;
      }
      .preference-row p {
          flex-shrink: 0;
          margin: 0;
      }

      .radio-group {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        margin-bottom: 0;
        padding: 5px 5px;
        border: 1px solid #ddd;
        border-radius: 4px;
        flex-grow: 1;
        flex-wrap: wrap;
        height: 38px;
        box-sizing: border-box;
      }
      .radio-group label {
        display: flex;
        align-items: center;
        font-size: 0.9em;
        cursor: pointer;
      }
      .radio-group input[type="radio"] {
        width: auto;
        margin-right: 5px;
      }

      #editStyleSettingsButton {
          width: 28px;
          height: 28px;
          padding: 0;
          margin-left: 10px;
          align-self: center;
          margin-top: 2px;
          background-color: #555;
          line-height: 1;
          font-size: 1em;
          border: none;
          flex-shrink: 0;
      }
      #editStyleSettingsButton:hover {
          background-color: #777;
      }
      
      #editStyleSettingsButtonOffline {
          width: 28px;
          height: 28px;
          padding: 0;
          margin-left: 10px;
          align-self: center;
          margin-top: 2px;
          background-color: #555;
          line-height: 1;
          font-size: 1em;
          border: none;
          flex-shrink: 0;
      }
      #editStyleSettingsButtonOffline:hover {
          background-color: #777;
      }

      .style-selection-group {
          display: flex;
          align-items: center;
          width: 100%;
          border: 1px solid #ddd;
          border-radius: 4px;
          padding: 3px 5px;
          height: 38px;
          box-sizing: border-box;
          margin-bottom: 10px;
      }
      .style-radio-group {
          display: flex;
          gap: 10px;
          flex-grow: 1;
          justify-content: center;
          align-items: center;
      }
      .style-radio-group label {
          display: flex;
          align-items: center;
          font-size: 0.9em;
          cursor: pointer;
      }
      .style-radio-group input[type="radio"] {
          width: auto;
          margin-right: 5px;
      }
      /* Status text formatting */
      .status-text {
        margin-top: 5px;
        color: #e50914;
        font-weight: bold;
      }
      
      /* --- NEW: Checkbox Row Style --- */
      .checkbox-row {
        display: flex;
        align-items: center;
        margin-top: 15px;
      }
      .checkbox-row input[type="checkbox"] {
          width: auto;
          margin-top: 0;
          margin-bottom: 0;
      }
      .checkbox-row label {
          margin-left: 8px;
          cursor: pointer;
          margin-bottom: 0; 
      }
      /* --- END: Checkbox Row Style --- */
      
      /* --- MODIFICATION: Offline List Styles --- */
      #saved-videos-list {
        border: 1px solid #ddd;
        border-radius: 4px;
        height: 200px;
        overflow-y: auto;
        background-color: #f9f9f9;
        /* MODIFICATION: Remove padding, items will have it */
        padding: 0;
        margin-top: 10px; /* Add margin above the list */
      }
      #saved-videos-list p {
        color: #777;
        text-align: center;
        margin-top: 20px;
        padding: 0 10px; /* Add padding for placeholder */
      }
      
      /* --- MODIFICATION START: Styles for Saved Video Items --- */
      .saved-video-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 10px;
        border-bottom: 1px solid #eee;
        font-size: 0.85em;
      }
      .saved-video-item:last-child {
          border-bottom: none;
      }
      .saved-video-item span {
        flex-grow: 1;
        margin-right: 10px;
        cursor: pointer;
        /* Truncate text if too long */
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      /* --- NEW: Style for selected item --- */
      .saved-video-item.active {
        background-color: #e6f7ff; /* A light blue/green */
        font-weight: bold;
      }
      .saved-video-item span:hover {
        text-decoration: underline;
      }
      /* --- END NEW --- */
      .delete-sub-btn {
        flex-shrink: 0;
        width: 22px;
        height: 22px;
        border: 1px solid #ccc;
        background: #f0f0f0;
        color: #333;
        cursor: pointer;
        border-radius: 50%;
        font-size: 0.9em;
        line-height: 20px;
        padding: 0;
        font-weight: bold;
        transition: background-color 0.2s, color 0.2s;
      }
      .delete-sub-btn:hover {
        background-color: #e0e0e0;
        color: #e50914; /* Use brand red */
      }
      /* --- MODIFICATION END --- */

      /* --- MODIFICATION: Offline Instructions Styles --- */
      #offline-instructions {
        margin-top: 0;
      }
      #offline-instructions h2 {
         margin-top: 0; /* Remove top margin from the first h2 in offline mode */
      }
      
    </style>
  </head>
  <body>
    
    <h1 id="titleHeader">Language Stream</h1>
    <div class="mode-switcher">
      <div class="mode-icon active" id="youtubeModeButton" title="YouTube Mode">
        <img src="youtube_icon.png" width="24" height="24" alt="YouTube Mode">
      </div>
      <div class="mode-icon" id="netflixModeButton" title="Netflix Mode">
        <img src="netflix_icon.png" width="24" height="24" alt="Netflix Mode">
      </div>
      <div class="mode-icon" id="disneyModeButton" title="Disney+ Mode">
        <img src="disney_icon.png" width="24" height="24" alt="Disney+ Mode" style="border-radius: 3px;">
      </div>
      <div class="mode-icon" id="primeModeButton" title="Prime Video Mode">
        <img src="amazon_video_icon.png" width="28" height="28" alt="Prime Video Mode">
      </div>
    </div>
    
    <div class="master-mode-switcher">
      <button id="onlineModeButton" class="master-mode-btn active">Online</button>
      <button id="offlineModeButton" class="master-mode-btn">Offline</button>
    </div>

    <div id="online-mode-container">
      <div id="netflixInputs">
        <h2 id="urlHeader">1. Retrieve Subtitle URL</h2>
        <div id="urlInstructions">
          <p>Open Netflix's player and  set subtitles to your Base Language</p>
          <p>Right click video player > Inspect > Network > Reload Page</p>
          <p>Search ?o= > Sort by name (descending)</p>
          <div style="display: flex; justify-content: space-between; align-items: center;">
              <p style="margin: 0; padding: 0; margin-bottom: 5px">Right click the top name (starting with ?o=) > Copy > Copy URL</p>
          </div>
        </div>
        <input type="text" id="subtitleUrlInput" placeholder="Paste Netflix TTML URL here" value="">

        <p id="urlStatusText" class="status-text">&nbsp;</p>
      </div>

      <div id="youtubeInputs" class="hidden-no-space">
        <h2 id="transcriptHeader">1. Retrieve Transcript</h2>
        <div id="transcriptInstructions">
          <p>Expand the bio below the video</p>
          <p>Click Show transcript</p>
        </div>
        <textarea id="youtubeTranscriptInput" placeholder="Paste full YouTube transcript here..."></textarea>

        <p id="transcriptStatusText" class="status-text">&nbsp;</S>
      </div>

      <div id="disneyInputs" class="hidden-no-space">
        <h2 id="disneyHeader">1. Retrieve Subtitle URL</h2>
        <div id="disneyInstructions">
          <p>Open Disney+'s player and  set subtitles to your Base Language</p>
          <p>Right click video player > Inspect</p>
          <p>Press Network > Reload Page</p>
          <p>Search .vtt > Sort by Size (descending)</p>
          <div style="display: flex; justify-content: space-between; align-items: center;">
              <p style="margin: 0; padding: 0; margin-bottom: 5px">Right click the top name > Copy > Copy URL</p>
          </div>
        </div>
        <input type="text" id="disneyUrlInput" placeholder="Paste Disney+ Subtitle URL here" value="">

        <p id="disneyUrlStatusText" class="status-text">&nbsp;</p>
      </div>

      <div id="primeInputs" class="hidden-no-space">
        <h2 id="primeHeader">1. Upload Subtitle File</h2>
        <div id="primeInstructions">
          <p>Open Prime Video's player and set subtitles to your Base Language</p>
          <p>Right click video player > Inspect</p>
          <p>Press Network > Reload Page > Resume</p>
          <div style="display: flex; justify-content: space-between; align-items: center;">
              <p style="margin: 0; padding: 0; margin-bottom: 5px">Search ttml2 > Right click top option > Open in new tab > Save file</p>
          </div>
        </div>
        <input type="file" id="primeFileInput" class="hidden-no-space" accept=".ttml,.ttml2,.xml">
        <button id="primeUploadButton" type="button">Upload .ttml2 File</button>

        <p id="primeUrlStatusText" class="status-text" style="color: #00A8E1;">&nbsp;</p>
      </div>


      <h2 id="languageHeader">2. Select Language</h2>
      <input type="text" id="targetLanguage" placeholder="Enter language to translate to (2 letter or in full)" value="">

      <p id="langStatusText" class="status-text">&nbsp;</p>

      <h2 id="generateHeader">3. (Save and) Generate Subtitles</h2>
      
      <div class="checkbox-row" style="margin-top: 5px;">
          <input type="checkbox" id="saveForOfflineCheckbox" name="saveForOffline">
          <label for="saveForOfflineCheckbox">Save subtitles for offline mode</label>
      </div>

      <button id="confirmButton">Generate Subtitles</button>
      
      <div id="statusBox" class="hidden-no-space">
        <p id="statusText">Waiting for URL...</p>
        <div id="progressBarContainer">
          <div id="progressBar"></div>
        </div>
      </div>
      <h3 id="preferencesHeader" class="hidden-no-space">4. Select Subtitle Preferences</h3>

      <div class="preference-row">
          <p>Mode:</p>
          <div id="subtitleModeGroup" class="radio-group">
              <label>
                  <input type="radio" name="subtitleMode" value="dual" id="subtitleModeDual" checked>
                  Dual
              </label>
              <label>
                  <input type="radio" name="subtitleMode" value="translated_only" id="subtitleModeTranslatedOnly">
                  Translated
              </label>
          </div>
      </div>

      <div class="preference-row" style="margin-bottom: 15px;">
          <p>Style:</p>
          <div class="style-selection-group">
              <div id="subtitleStyleGroup" class="style-radio-group">
                  <label>
                      <input type="radio" name="subtitleStyle" value="netflix" id="subtitleStyleNetflix" checked>
                      Netflix
                  </label>
                  <label>
                      <input type="radio" name="subtitleStyle" value="custom" id="subtitleStyleCustom">
                      Custom
                  </label>
                  <label>
                      <input type="radio" name="subtitleStyle" value="vocabulary" id="subtitleStyleVocabulary">
                      Vocab
                  </label>
                  </div>
              <button id="editStyleSettingsButton" title="Edit Style Settings" disabled>&#x2699;</button>
          </div>
      </div>
      
      </div>
    
    <div id="offline-mode-container" class="hidden-no-space">
      <div id="offline-instructions">
          <h2>Instructions for Watching</h2>
          <div id="offlineInstructionsText">
              <p>Instructions specific to this service will go here...</p>
          </div>
      </div>
      
      <div id="saved-videos-list">
        <p>No saved videos found for this service.</p>
      </div>
      
      <button id="displayOfflineSubtitlesButton" type="button" style="margin-top: 10px; background-color: #4CAF50;">Display Subtitles</button>
      
      
      <div class="preference-row" style="margin-top: 10px;">
          <p>Mode:</p>
          <div id="subtitleModeGroupOffline" class="radio-group">
              <label>
                  <input type="radio" name="subtitleModeOffline" value="dual" id="subtitleModeDualOffline" checked>
                  Dual
              </label>
              <label>
                  <input type="radio" name="subtitleModeOffline" value="translated_only" id="subtitleModeTranslatedOnlyOffline">
                  Translated
              </label>
          </div>
      </div>

      <div class="preference-row" style="margin-bottom: 15px;">
          <p>Style:</p>
          <div class="style-selection-group">
              <div id="subtitleStyleGroupOffline" class="style-radio-group">
                  <label>
                      <input type="radio" name="subtitleStyleOffline" value="netflix" id="subtitleStyleNetflixOffline" checked>
                      Netflix
                  </label>
                  <label>
                      <input type="radio" name="subtitleStyleOffline" value="custom" id="subtitleStyleCustomOffline">
                      Custom
                  </label>
                  <label>
                      <input type="radio" name="subtitleStyleOffline" value="vocabulary" id="subtitleStyleVocabularyOffline">
                      Vocab
                  </label>
                  </div>
              <button id="editStyleSettingsButtonOffline" title="Edit Style Settings" disabled>&#x2699;</button>
          </div>
      </div>
      </div>
    <button id="cancelButton" class="hidden-no-space">Cancel Subtitle Generation</button>

    <script src="popup.js"></script>
  </body>
</html>